<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html [
        <!ENTITY nbsp "&#160;">
        <!ENTITY copy "&#169;">
        ]>
<html lang="de"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
<!--@elvariable id="hoererSession" type="wbh.bookworm.hoerbuchkatalog.ui.katalog.HoererSession"-->
<!--@elvariable id="meineDownloads" type="wbh.bookworm.hoerbuchkatalog.ui.katalog.MeineDownloads"-->
<ui:composition template="hoerbuchkatalog-ui.xhtml">
    <ui:define name="container">
        <h:panelGroup rendered="#{hoererSession.hoererIstUnbekannt}">
            Leider ist Ihre Hörernummer dem Hörbuchkatalog-System nicht bekannt.<br/>
            Bitte melden Sie sich <a href="/cb-login.html">hier</a> an oder wenden Sie sich an die WBH.
        </h:panelGroup>
        <h:panelGroup rendered="#{hoererSession.hoererIstBekannt}"
                      layout="block" styleClass="leading">
            <h2 class="contentheading">Meine Downloads</h2>
            <h4 class="contentheading">Stand: #{meineDownloads.standVomAufDeutsch}</h4>
            <div class="contact-data">
                <div class="hoerer">
                    <span class="entry-name">#{hoererSession.hoerername}</span>
                    - Hörernummer:
                    <span class="entry-hrnr">#{hoererSession.hoerernummer}</span>
                </div>
            </div>
            <h:form id="meineDownloads">
                <h:panelGroup rendered="#{meineDownloads.blistaAbrufHatFehler}"
                              id="blistaAbrufFehler"
                              layout="block" styleClass="row">
                    Die Downloads stehen temporär leider nicht zur Verfügung.<br/>
                    <br/>
                    <h:outputText value="#{meineDownloads.blistaFehlercode}"/>:
                    <h:outputText value="#{meineDownloads.blistaFehlermeldung}"/><br/>
                    <br/>
                    Bitte entschuldigen Sie die Unannehmlichkeit und versuchen Sie es später noch einmal.<br/>
                    Vielen Dank!
                </h:panelGroup>
                <h:panelGroup rendered="#{!meineDownloads.blistaAbrufHatFehler}"
                              layout="block" styleClass="searchrow">
                    <h3>Suchen Sie einen Titel innerhalb Ihrer Downloads</h3>
                    <h:inputText id="stichwort"
                                 value="#{meineDownloads.stichwort}"
                                 styleClass="searchtitle"/>
                    <h:commandButton id="downloadsDurchsuchen"
                                     actionListener="#{meineDownloads.sucheNachStichwort}"
                                     styleClass="searchbutton"
                                     value="Suchen">
                        <f:ajax event="action" execute="@form" render="@all"/>
                    </h:commandButton>
                </h:panelGroup>
                <h:panelGroup rendered="#{!meineDownloads.blistaAbrufHatFehler and !meineDownloads.hoerbucherAusgeliehen}"
                              layout="block" styleClass="row notitle">
                    Es wurden keine Hörbücher ausgeliehen!
                </h:panelGroup>
                <h:panelGroup rendered="#{meineDownloads.stichwortEingegeben and !meineDownloads.stichwortHatTreffer}"
                              layout="block" styleClass="row notitle">
                    Es wurden keine Hörbücher ausgeliehen, die Ihrer Suche entsprechen!
                </h:panelGroup>
                <h:panelGroup id="archivTabelle"
                              rendered="#{meineDownloads.hoerbuecherAnzeigen}"
                              layout="block" styleClass="row">
                    <div class="col-lg-12">
                        <table class="table table-striped">
                            <tbody>
                            <tr>
                                <th>Titelnr./Bestelldatum</th>
                                <th>Titel/Autor/Dauer</th>
                                <th style="text-align:center;">Download</th>
                                <th style="text-align:center;">Verfügbar</th>
                            </tr>
                            <ui:repeat value="#{meineDownloads.gefilterteBezugsfaehigeDownloads}"
                                       var="download" varStatus="downloadStatus">
                                <h:outputFormat rendered="#{downloadStatus.last}">
                                    <tr>
                                        <td class="lastrow" colspan="4">Hinweis: Es folgt der letzte Datensatz</td>
                                    </tr>
                                </h:outputFormat>
                                <tr>
                                    <td class="date">
                                        <table class="table-striped-title">
                                            <tbody>
                                            <tr>
                                                <td headers="Buchnummer">#{download.titelnummer}</td>
                                            </tr>
                                            <tr>
                                                <td headers="Ausleihdatum">#{download.bestelldatumAufDeutsch}</td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </td>
                                    <td class="title-data">
                                        <h:panelGroup>
                                            <table class="table-striped-data">
                                                <tbody>
                                                <tr>
                                                    <td headers="Buchtitel">#{download.titel}</td>
                                                </tr>
                                                <tr>
                                                    <td headers="Autor">#{download.autor}</td>
                                                </tr>
                                                <tr>
                                                    <td headers="Spieldauer">#{download.spieldauer}</td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </h:panelGroup>
                                    </td>
                                    <td class="bereitstellung">
                                        <div class="status">
                                            <h:outputText value="#{download.statusText}"/>
                                        </div>
                                        <div class="link">
                                            <h:commandLink rendered="#{download.bezugsfaehig}"
                                                           actionListener="#{meineDownloads.downloadZaehlen}"
                                                           action="#{meineDownloads.downloadLink(download)}"
                                                           target="_blank"
                                                           value="Herunterladen">
                                            </h:commandLink>
                                        </div>
                                    </td>
                                    <td class="download-count">
                                        <h:outputText value="#{download.getaetigteDownloads} / #{download.maxDownload}"/>
                                    </td>
                                </tr>
                            </ui:repeat>
                            </tbody>
                        </table>
                    </div>
                </h:panelGroup>
            </h:form>
        </h:panelGroup>
        <h:panelGroup rendered="#{hoererSession.hoererIstBekannt}"
                      layout="block" styleClass="noticetext">
            <h3>Hinweise zu Ihrer Downloadbestellung</h3>
            <p>Mit Ihrer Bestellung wird jeweils eine Hörbuchdatei inkl. Wasserzeichen generiert. Informationen zum Bearbeitungsstatus erhalten Sie in der Spalte "Download".</p>
            <p>Sobald Ihre Bestellung für einen Download bereit steht, ändert sich der Status auf "3: Bereitstellung abgeschlossen" und ein Link zum Herunterladen wird angezeigt.</p>
            <p>Sie können eine Hörbuchdatei bis zu 5 Mal herunterladen. Die Spalte "Verfügbar" gibt an, wie oft Sie die Datei erneut herunterladen können.</p>
            <p>Urheberrechtshinweis: Jede Downloaddatei wird mit einem individuellen Wasserzeichen versehen und kann bei Zweckentfremdung (unberechtigte Weitergabe) dem Verursacher zugeordnet werden.</p>
        </h:panelGroup>
    </ui:define>
</ui:composition>
</html>
